---
name: Build and Install Matrix

on:
  push:
    # branches:
    #   - main
  pull_request:

jobs:
  build-and-install:
    runs-on: ubuntu-latest  # GitHub-hosted runner
    strategy:
      matrix:
        container:
          - ubuntu:24.04
          - fedora:41
    container:
      image: ${{ matrix.container }}  # Dynamically use the image from the matrix
    steps:
      - name: Checkout code
        uses: actions/checkout@v3

      - name: Run make install
        env:
          DEBIAN_FRONTEND: noninteractive
          TZ: Etc/UTC
        run: |
          bash ./bootstrap.sh && make desktop

      - name: Run tests
        run: |
          # shellcheck disable=SC1090
          source ~/.bashrc && make test
        shell: bash

      - name: Install 1password
        run: |
          source ~/.bashrc && make 1password
        shell: bash

      - name: Install resilio
        run: |
          source ~/.bashrc && make resilio
        shell: bash

      - name: Install tailscale
        run: |
          source ~/.bashrc && make tailscale
        shell: bash
